import{D as k,az as q,c as v,aW as C,j as u,k as Q,d as a,O as x,l as o,I as l,n as B,N as m,J as $,Q as c,F as I,K as N,L as z,H as p}from"./index.1a02ddf5.js";import{Q as S}from"./QImg.c163d33a.js";import{Q as T,a as r}from"./QTable.39becedc.js";import{Q as _}from"./QBadge.1a2299c6.js";import{u as V}from"./use-quasar.a1ee8c6c.js";import"./QList.2a77489d.js";import"./QSelect.967a2e9e.js";import"./QItem.0ee57efb.js";import"./QItemSection.916b879a.js";import"./QItemLabel.b50139ee.js";import"./QMenu.d4c0b63f.js";import"./rtl.b51694b1.js";import"./format.2a3572e1.js";const j=o("h3",{class:"text-center q-pa-lg"},"\u8CFC\u7269\u8ECA",-1),D={class:"q-pa-md q-gutter-xl"},F={class:"full-width row flex-center text-accent q-gutter-sm"},P={class:"row justify-end"},A={class:"col-10 text-right"},H={class:"q-ma-none"},J={class:"col-2 text-right"},ae={__name:"CartPage",setup(K){const f=k(),{editCart:g}=f,y=V(),i=q([]),b=[{name:"image",label:"\u5716\u7247",align:"left",field:e=>e.p_id.image},{name:"name",label:"\u540D\u7A31",align:"left",field:e=>e.p_id.name,sortable:!0},{name:"price",label:"\u55AE\u50F9",align:"left",field:e=>e.p_id.price,sortable:!0},{name:"quantity",label:"\u6578\u91CF",align:"left",field:e=>e.quantity},{name:"edit",label:"\u7DE8\u8F2F",align:"left",field:e=>e.sell},{name:"total",label:"\u5C0F\u8A08",align:"left",field:e=>e.quantity*e.p_id.price,sortable:!0},{name:"state",label:"\u72C0\u614B",align:"left",field:e=>e.state,sortable:!0},{name:"delete",label:"\u522A\u9664",align:"left",field:e=>e.delete}],d=async(e,s)=>{const t=i.findIndex(w=>w._id===e),n=s===0?-i[t].quantity:s;await g({_id:i[t].p_id._id,quantity:n}),i[t].quantity+=n,i[t].quantity<=0&&i.splice(t,1)},h=v(()=>i.reduce((e,s)=>e+s.p_id.price*s.quantity,0));return(async()=>{try{const{data:e}=await C.get("/users/cart");i.push(...e.result)}catch{y.notify({position:"center",color:"negative",message:"\u5931\u6557",icon:"check_circle",timeout:2e3})}})(),(e,s)=>(u(),Q(I,null,[j,a(x,{inset:""}),o("div",D,[a(T,{title:"\u8CFC\u7269\u8ECA",rows:i,columns:b,"row-key":"_id","rows-per-page-options":[4,10],filter:e.filter,"no-data-label":"\u6C92\u6709\u5546\u54C1",class:B(e.bg-e.accent)},{"body-cell-image":l(t=>[a(r,null,{default:l(()=>[a(S,{style:{height:"120px"},src:t.row.p_id.image},null,8,["src"])]),_:2},1024)]),"body-cell-edit":l(t=>[a(r,null,{default:l(()=>[a(c,{flat:"",round:"",color:"primary",icon:"remove",onClick:n=>d(t.row._id,-1)},null,8,["onClick"]),N(" \xA0"+m(t.row.quantity)+"\xA0 ",1),a(c,{flat:"",round:"",color:"primary",icon:"add",onClick:n=>d(t.row._id,1)},null,8,["onClick"])]),_:2},1024)]),"body-cell-delete":l(t=>[a(r,null,{default:l(()=>[a(c,{round:"",color:"negative",label:"\u522A\u9664",onClick:n=>d(t.row._id,0)},null,8,["onClick"])]),_:2},1024)]),"no-data":l(({message:t})=>[a(r,null,{default:l(()=>[o("div",F,[a(z,{size:"2em",name:"sentiment_dissatisfied"}),o("span",null,m(t),1)])]),_:2},1024)]),"body-cell-state":l(t=>[a(r,null,{default:l(()=>[t.row.p_id.sell?(u(),p(_,{key:0,outline:"",color:"primary",label:"\u5DF2\u4E0A\u67B6"})):(u(),p(_,{key:1,outline:"",label:"\u5DF2\u4E0B\u67B6",color:"accent"}))]),_:2},1024)]),_:1},8,["rows","filter","class"]),o("div",P,[o("div",A,[o("h6",H,"\u7E3D\u91D1\u984D: $"+m($(h)),1)]),o("div",J,[a(c,{color:"positive",label:"\u7D50\u5E33",to:"/CreditCard"})])])])],64))}};export{ae as default};
