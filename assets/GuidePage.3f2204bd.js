import{az as k,r as B,aW as p,j as c,k as Q,d as t,O as F,l as d,Q as u,I as i,bl as D,F as v,aE as f,aU as x,N as L,aN as b,J as r,L as y,aK as N,H as _,b5 as A,aD as $,P as E}from"./index.fdacf0ac.js";import{Q as G}from"./QSelect.daa2869e.js";import{Q as P,a as q,C as T}from"./ClosePopup.94fb7aa7.js";import{Q as h}from"./QImg.eec43c85.js";import{Q as O}from"./QForm.b46f429a.js";import{Q as S}from"./QBadge.1106d0db.js";import{Q as H,a as m}from"./QTable.009d8102.js";import{u as J}from"./use-quasar.2fb35de7.js";import"./QItem.2285122c.js";import"./QItemSection.4b91469c.js";import"./QItemLabel.49fc0180.js";import"./QMenu.b14e4816.js";import"./rtl.b51694b1.js";import"./format.3e32b8d9.js";import"./QList.554f7fd8.js";const K=d("h5",{class:"text-center q-pa-lg"},"\u6587\u7AE0\u7BA1\u7406",-1),M={class:"row justify-start q-pa-md"},R={class:"text-h6 text-center"},W={class:"row q-pa-md"},X={class:"row q-pa-md"},Y={class:"q-pa-md q-gutter-xl"},fe={__name:"GuidePage",setup(Z){const s=J(),C=["\u884C\u524D\u6E96\u5099","\u6CE8\u610F\u4E8B\u9805","\u4EA4\u901A\u8CC7\u8A0A","\u666F\u9EDE\u4ECB\u7D39"],w={required(l){return!!l||"\u6B04\u4F4D\u5FC5\u586B"},price(l){return l>=0||"\u50F9\u683C\u932F\u8AA4"}},n=k([]),g=B(""),z=[{name:"image",label:"\u5716\u7247",align:"left",field:l=>l.image},{name:"title",label:"\u6A19\u984C",align:"left",field:l=>l.title,sortable:!0},{name:"category",label:"\u7A2E\u985E",align:"left",field:l=>l.category},{name:"sell",label:"\u767C\u4F48\u72C0\u614B",align:"left",field:l=>l.sell,sortable:!0},{name:"edit",label:"\u7DE8\u8F2F",align:"left",field:l=>l.edit},{name:"delete",label:"\u522A\u9664",align:"left",field:l=>l.delete}],e=k({_id:"",title:"",subtitle:"",description:"",image:void 0,images:[],sell:!1,category:"",loading:"",dialog:!1,idx:-1}),V=l=>{l===-1?(e._id="",e.title="",e.subtitle="",e.description="",e.image=void 0,e.images=[],e.sell=!1,e.loading=!1,e.idx=-1):(e._id=n[l]._id,e.title=n[l].title,e.subtitle=n[l].subtitle,e.description=n[l].description,e.image=n[l].image,e.images=n[l].images,e.sell=n[l].sell,e.category=n[l].category,e.loading=!1,e.idx=l),e.dialog=!0},U=async()=>{e.loading=!0;const l=new FormData;l.append("title",e.title),l.append("subtitle",e.subtitle),l.append("description",e.description),l.append("image",e.image);for(const o of e.images)l.append("images",o);l.append("sell",e.sell),l.append("category",e.category);try{if(e._id.length===0){const{data:o}=await p.post("/guides",l);n.push(o.result),s.notify({position:"center",color:"positive",message:"\u6587\u7AE0\u65B0\u589E\u6210\u529F",icon:"check_circle",timeout:2e3})}else{const{data:o}=await p.patch("/guides/"+e._id,l);n[e.idx]=o.result,s.notify({position:"center",color:"positive",message:"\u6587\u7AE0\u7DE8\u8F2F\u6210\u529F",icon:"check_circle",timeout:2e3})}e.dialog=!1}catch{s.notify({position:"center",color:"negative",message:"\u5931\u6557",icon:"check_circle",timeout:2e3})}},j=async l=>{try{await p.patch("/guides/delete/"+l,{status:1});const o=n.findIndex(a=>a._id===l);n.splice(o,1),s.notify({position:"center",color:"positive",message:"\u6587\u7AE0\u522A\u9664\u6210\u529F",icon:"check_circle",timeout:2e3})}catch{s.notify({position:"center",color:"negative",message:"\u6587\u7AE0\u522A\u9664\u5931\u6557",icon:"check_circle",timeout:2e3})}};return(async()=>{try{const{data:l}=await p.get("/guides/all");n.push(...l.result)}catch{console.log("\u53D6\u5F97\u6587\u7AE0\u5931\u6557")}})(),(l,o)=>(c(),Q(v,null,[K,t(F,{inset:""}),d("div",M,[t(u,{color:"accent","text-color":"white",label:"\u65B0\u589E\u6587\u7AE0",onClick:o[0]||(o[0]=a=>V(-1))})]),t(D,{modelValue:e.dialog,"onUpdate:modelValue":o[8]||(o[8]=a=>e.dialog=a),persistent:""},{default:i(()=>[t(f,{class:"my-card",style:{"min-width":"600px"}},{default:i(()=>[t(O,{onSubmit:U},{default:i(()=>[t(x,{class:"bg-secondary"},{default:i(()=>[d("div",R,L(e._id.length>0?"\u7DE8\u8F2F\u6587\u7AE0":"\u65B0\u589E\u6587\u7AE0"),1)]),_:1}),t(x,{class:"flex justify-center items-center row"},{default:i(()=>[t(b,{modelValue:e.title,"onUpdate:modelValue":o[1]||(o[1]=a=>e.title=a),outlined:"",type:"text",label:"\u6587\u7AE0\u6A19\u984C",rules:[w.required],"lazy-rules":"",class:"col-12 q-pa-md"},null,8,["modelValue","rules"]),t(b,{modelValue:e.subtitle,"onUpdate:modelValue":o[2]||(o[2]=a=>e.subtitle=a),outlined:"",type:"text",label:"\u6587\u7AE0\u526F\u6A19\u984C","lazy-rules":"",class:"col-12 q-pa-md"},null,8,["modelValue"]),t(G,{modelValue:e.category,"onUpdate:modelValue":o[3]||(o[3]=a=>e.category=a),options:C,rules:[w.required],label:"\u6587\u7AE0\u5206\u985E","lazy-rules":"",class:"col-12 q-pa-md",outlined:""},null,8,["modelValue","rules"]),t(P,{modelValue:e.description,"onUpdate:modelValue":o[4]||(o[4]=a=>e.description=a),dense:r(s).screen.lt.md,toolbar:[[{label:r(s).lang.editor.align,icon:r(s).iconSet.editor.align,fixedLabel:!0,list:"only-icons",options:["left","center","right","justify"]},{label:r(s).lang.editor.align,icon:r(s).iconSet.editor.align,fixedLabel:!0,options:["left","center","right","justify"]}],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],["print","fullscreen"],[{label:r(s).lang.editor.formatting,icon:r(s).iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:r(s).lang.editor.fontSize,icon:r(s).iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:r(s).lang.editor.defaultFont,icon:r(s).iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["viewsource"]],fonts:{arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"}},null,8,["modelValue","dense","toolbar"]),t(q,{modelValue:e.image,"onUpdate:modelValue":o[5]||(o[5]=a=>e.image=a),class:"col-12 q-pa-md justify-center",removable:"",label:"\u9078\u64C7\u5716\u7247",outlined:"","use-chips":""},{prepend:i(()=>[t(y,{name:"attach_file"})]),_:1},8,["modelValue"]),d("div",W,[t(f,{class:"my-card col",flat:"",bordered:""},{default:i(()=>[t(h,{src:e.image,width:"100px"},null,8,["src"])]),_:1})]),t(q,{modelValue:e.images,"onUpdate:modelValue":o[6]||(o[6]=a=>e.images=a),class:"col-12 q-pa-md justify-center",removable:"",multiple:"",label:"\u9078\u64C7\u591A\u5F35\u5716\u7247",outlined:"","use-chips":""},{prepend:i(()=>[t(y,{name:"attach_file"})]),_:1},8,["modelValue"]),d("div",X,[(c(!0),Q(v,null,N(e.images,a=>(c(),_(f,{key:a,class:"my-card col",flat:"",bordered:""},{default:i(()=>[t(h,{src:a,width:"100px"},null,8,["src"])]),_:2},1024))),128))]),t(A,{modelValue:e.sell,"onUpdate:modelValue":o[7]||(o[7]=a=>e.sell=a),label:"\u6587\u7AE0\u767C\u5E03",class:"col-12 q-pa-md justify-center"},null,8,["modelValue"])]),_:1}),t($,{align:"right",class:"text-primary q-pa-md"},{default:i(()=>[E(t(u,{flat:"",label:"\u53D6\u6D88",disable:e.loading},null,8,["disable"]),[[T]]),t(u,{flat:"",label:"\u9001\u51FA",type:"submit",loading:e.loading},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),d("div",Y,[t(H,{rows:n,columns:z,"row-key":"_id","rows-per-page-options":[4,10],filter:g.value},{"body-cell-sell":i(a=>[t(m,null,{default:i(()=>[a.row.sell?(c(),_(S,{key:0,color:"primary",label:"\u767C\u5E03\u4E2D"})):(c(),_(S,{key:1,color:"accent",label:"\u672A\u767C\u5E03"}))]),_:2},1024)]),"body-cell-image":i(a=>[t(m,null,{default:i(()=>[t(h,{style:{height:"120px"},src:a.row.image},null,8,["src"])]),_:2},1024)]),"top-right":i(()=>[t(m,null,{default:i(()=>[t(b,{borderless:"",dense:"",debounce:"300",modelValue:g.value,"onUpdate:modelValue":o[9]||(o[9]=a=>g.value=a),placeholder:"Search"},{append:i(()=>[t(y,{name:"search"})]),_:1},8,["modelValue"])]),_:1})]),"body-cell-edit":i(a=>[t(m,null,{default:i(()=>[t(u,{round:"",color:"primary",icon:"edit",onClick:I=>V(n.indexOf(a.row))},null,8,["onClick"])]),_:2},1024)]),"body-cell-delete":i(a=>[t(m,null,{default:i(()=>[t(u,{round:"",color:"accent",icon:"delete",onClick:I=>j(a.row._id)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["rows","filter"])])],64))}};export{fe as default};
