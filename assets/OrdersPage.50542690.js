import{az as b,r as h,aW as p,j as c,k as d,d as l,O as y,l as m,I as r,F as f,aK as k,N as w,Q as v,aN as Q,L as x}from"./index.babb187d.js";import{Q as q,a as u}from"./QTable.5bb4ad7b.js";import{u as V}from"./use-quasar.b603fb8b.js";import"./QList.24407ede.js";import"./QSelect.62d762cc.js";import"./QItem.3ebbc640.js";import"./QItemSection.98cee797.js";import"./QItemLabel.5c88961a.js";import"./QMenu.dd0a02a7.js";import"./rtl.b51694b1.js";import"./format.3e32b8d9.js";const B=m("h5",{class:"text-center q-pa-lg"},"\u8A02\u55AE\u7BA1\u7406",-1),I={class:"q-pa-md q-gutter-xl"},A={__name:"OrdersPage",setup(N){const n=V(),i=b([]),s=h(""),_=[{name:"user",label:"\u4E0B\u55AE\u6703\u54E1",align:"left",field:e=>e.u_id.account,sortable:!0},{name:"name",label:"\u5546\u54C1\u540D\u7A31",align:"left",field:e=>e._id,sortable:!0},{name:"id",label:"\u8A02\u55AE\u7DE8\u865F",align:"left",field:e=>e._id},{name:"date",label:"\u4E0B\u55AE\u65E5\u671F",align:"left",field:e=>new Date(e.date).toLocaleDateString(),sortable:!0},{name:"totalPrice",label:"\u7E3D\u91D1\u984D",align:"left",field:e=>e.totalPrice,sortable:!0},{name:"delete",label:"\u522A\u9664",align:"left",field:e=>e.delete}],g=async e=>{try{await p.patch("/orders/delete/"+e,{status:1});const t=i.findIndex(a=>a._id===e);i.splice(t,1),n.notify({position:"center",color:"positive",message:"\u522A\u9664\u6210\u529F",icon:"check_circle",timeout:2e3})}catch{n.notify({position:"center",color:"negative",message:"\u5931\u6557",icon:"check_circle",timeout:2e3})}};return(async()=>{try{const{data:e}=await p.get("/orders/all");i.push(...e.result.map(t=>(t.totalPrice=t.products.reduce((a,o)=>a+o.p_id.price*o.quantity,0),t)))}catch{n.notify({position:"center",color:"negative",message:"\u53D6\u5F97\u8A02\u55AE\u5931\u6557",icon:"check_circle",timeout:2e3})}})(),(e,t)=>(c(),d(f,null,[B,l(y,{inset:""}),m("div",I,[l(q,{rows:i,columns:_,"row-key":"_id","rows-per-page-options":[4,10],filter:s.value},{"body-cell-name":r(a=>[l(u,null,{default:r(()=>[m("ul",null,[(c(!0),d(f,null,k(a.row.products,o=>(c(),d("li",{key:o._id}," \u2022 "+w(o.p_id.name+"x"+o.quantity),1))),128))])]),_:2},1024)]),"body-cell-delete":r(a=>[l(u,null,{default:r(()=>[l(v,{round:"",color:"accent",icon:"delete",onClick:o=>g(a.row._id)},null,8,["onClick"])]),_:2},1024)]),"top-right":r(()=>[l(u,null,{default:r(()=>[l(Q,{borderless:"",dense:"",debounce:"300",modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=a=>s.value=a),placeholder:"Search"},{append:r(()=>[l(x,{name:"search"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rows","filter"])])],64))}};export{A as default};
