import{aM as B,D as $,az as I,c as p,aW as N,j as u,k as z,d as l,O as S,l as i,I as o,n as T,N as m,J as _,Q as c,F as V,K as j,L as D,H as f}from"./index.73101a9e.js";import{Q as F}from"./QImg.b6142001.js";import{Q as P,a as r}from"./QTable.284b5eba.js";import{Q as g}from"./QBadge.6ad3d4bc.js";import{u as U}from"./use-quasar.bf5ef0d7.js";import"./QList.388ecd15.js";import"./QSelect.f38a56f8.js";import"./QItem.6ee542bb.js";import"./QItemSection.e8f96be7.js";import"./QItemLabel.e963084d.js";import"./QMenu.43ce2be0.js";import"./rtl.b51694b1.js";import"./format.3e32b8d9.js";const A=i("h5",{class:"text-center q-pa-lg"},"\u8CFC\u7269\u8ECA",-1),H={class:"q-pa-md q-gutter-xl"},J={class:"full-width row flex-center text-accent q-gutter-sm"},K={class:"row justify-end"},L={class:"col-10 text-right"},M={class:"q-ma-none"},O={class:"col-2 text-right"},ne={__name:"UserCartPage",setup(R){const y=B(),b=$(),{editCart:h,checkout:k}=b,w=U(),a=I([]),C=[{name:"image",label:"\u5716\u7247",align:"left",field:e=>e.p_id.image},{name:"name",label:"\u540D\u7A31",align:"left",field:e=>e.p_id.name,sortable:!0},{name:"price",label:"\u55AE\u50F9",align:"left",field:e=>e.p_id.price,sortable:!0},{name:"quantity",label:"\u6578\u91CF",align:"left",field:e=>e.quantity},{name:"edit",label:"\u7DE8\u8F2F",align:"left",field:e=>e.sell},{name:"total",label:"\u5C0F\u8A08",align:"left",field:e=>e.quantity*e.p_id.price,sortable:!0},{name:"state",label:"\u72C0\u614B",align:"left",field:e=>e.state,sortable:!0},{name:"delete",label:"\u522A\u9664",align:"left",field:e=>e.delete}],d=async(e,s)=>{const t=a.findIndex(x=>x._id===e),n=s===0?-a[t].quantity:s;await h({_id:a[t].p_id._id,quantity:n}),a[t].quantity+=n,a[t].quantity<=0&&a.splice(t,1)},q=p(()=>a.reduce((e,s)=>e+s.p_id.price*s.quantity,0)),v=async()=>{await k(),y.push("/orders")},Q=p(()=>a.length>0&&!a.some(e=>!e.p_id.sell));return(async()=>{try{const{data:e}=await N.get("/users/cart");a.push(...e.result)}catch{w.notify({position:"center",color:"negative",message:"\u5931\u6557",icon:"check_circle",timeout:2e3})}})(),(e,s)=>(u(),z(V,null,[A,l(S,{inset:""}),i("div",H,[l(P,{rows:a,columns:C,"row-key":"_id","rows-per-page-options":[4,10],filter:e.filter,"no-data-label":"\u6C92\u6709\u5546\u54C1",class:T(e.bg-e.accent)},{"body-cell-image":o(t=>[l(r,null,{default:o(()=>[l(F,{style:{height:"120px"},src:t.row.p_id.image},null,8,["src"])]),_:2},1024)]),"body-cell-edit":o(t=>[l(r,null,{default:o(()=>[l(c,{flat:"",round:"",color:"primary",icon:"remove",onClick:n=>d(t.row._id,-1)},null,8,["onClick"]),j(" \xA0"+m(t.row.quantity)+"\xA0 ",1),l(c,{flat:"",round:"",color:"primary",icon:"add",onClick:n=>d(t.row._id,1)},null,8,["onClick"])]),_:2},1024)]),"body-cell-delete":o(t=>[l(r,null,{default:o(()=>[l(c,{round:"",color:"negative",label:"\u522A\u9664",onClick:n=>d(t.row._id,0)},null,8,["onClick"])]),_:2},1024)]),"no-data":o(({message:t})=>[l(r,null,{default:o(()=>[i("div",J,[l(D,{size:"2em",name:"sentiment_dissatisfied"}),i("span",null,m(t),1)])]),_:2},1024)]),"body-cell-state":o(t=>[l(r,null,{default:o(()=>[t.row.p_id.sell?(u(),f(g,{key:0,outline:"",color:"primary",label:"\u5DF2\u4E0A\u67B6"})):(u(),f(g,{key:1,outline:"",label:"\u5DF2\u4E0B\u67B6",color:"accent"}))]),_:2},1024)]),_:1},8,["rows","filter","class"]),i("div",K,[i("div",L,[i("h6",M,"\u7E3D\u91D1\u984D: $"+m(_(q)),1)]),i("div",O,[l(c,{color:"positive",label:"\u7D50\u5E33",disabled:!_(Q),onClick:v},null,8,["disabled"])])])])],64))}};export{ne as default};
